<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="clr-namespace:JetJot.Models"
        xmlns:local="clr-namespace:JetJot"
        mc:Ignorable="d"
        d:DesignWidth="1000"
        d:DesignHeight="600"
        x:Class="JetJot.MainWindow"
        Title="JetJot"
        Icon="avares://JetJot/Logo.ico"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="40">

    <Window.Resources>
        <SolidColorBrush x:Key="AccentBrush" Color="#4A5D73"/>
        <SolidColorBrush x:Key="CaretBrush" Color="#4A5D73"/>
    </Window.Resources>

    <Window.Styles>
        <!-- TextBox focus border -->
        <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
        </Style>

        <!-- TextBox selection color -->
        <Style Selector="TextBox">
            <Setter Property="SelectionBrush" Value="{DynamicResource AccentBrush}"/>
        </Style>

        <!-- ComboBox focus and selection -->
        <Style Selector="ComboBox:focus /template/ Border#Background">
            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
        </Style>
        <Style Selector="ComboBox:pointerover /template/ Border#Background">
            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
        </Style>

        <!-- ComboBox dropdown item selection -->
        <Style Selector="ComboBoxItem:selected /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
        </Style>
        <Style Selector="ComboBoxItem:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
        </Style>

        <!-- CheckBox checked state -->
        <Style Selector="CheckBox:checked /template/ Border#NormalRectangle">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
        </Style>

        <!-- MenuItem hover/selected states -->
        <Style Selector="MenuItem:selected /template/ Border#PART_LayoutRoot">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
        </Style>
        <Style Selector="MenuItem:pointerover /template/ Border#PART_LayoutRoot">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
        </Style>

        <!-- Button hover/pressed states (for OK buttons in dialogs) -->
        <Style Selector="Button.accent-button">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
        </Style>
        <Style Selector="Button.accent-button:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
            <Setter Property="Opacity" Value="0.8"/>
        </Style>
    </Window.Styles>

    <Grid x:Name="MainOuterGrid" RowDefinitions="40,*,Auto">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Custom Title Bar -->
        <Border x:Name="TitleBarPanel" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Background="#2D2D2D">
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Left: Menu -->
                <Menu Grid.Column="0" Background="Transparent" VerticalAlignment="Center" Focusable="False">
                    <Menu.Styles>
                        <Style Selector="MenuItem">
                            <Setter Property="Focusable" Value="False"/>
                        </Style>
                        <Style Selector="MenuItem /template/ Popup">
                            <Setter Property="PlacementMode" Value="Bottom"/>
                            <Setter Property="PlacementTarget" Value="{Binding $parent[MenuItem]}"/>
                        </Style>
                    </Menu.Styles>
                    <MenuItem x:Name="FileMenu" Header="File" Foreground="#FFFFFF" SubmenuOpened="OnMenuSubmenuOpened">
                        <MenuItem Header="New Project" Click="OnNewManuscriptMenuClicked" InputGesture="Ctrl+Shift+N"/>
                        <MenuItem Header="Open/Import Project..." Click="OnImportManuscriptClicked" InputGesture="Ctrl+O"/>
                        <Separator/>
                        <MenuItem Header="New Document" Click="OnNewDocumentClicked" InputGesture="Ctrl+N"/>
                        <Separator/>
                        <MenuItem Header="Export">
                            <MenuItem Header=".txt" Click="OnExportTxtClicked"/>
                            <MenuItem Header=".md" Click="OnExportMdClicked"/>
                            <MenuItem Header=".html" Click="OnExportHtmlClicked"/>
                        </MenuItem>
                        <Separator/>
                        <MenuItem Header="Exit" Click="OnExitClicked"/>
                    </MenuItem>
                    <MenuItem Header="Edit" Foreground="#FFFFFF" SubmenuOpened="OnMenuSubmenuOpened">
                        <MenuItem Header="Rename Project" Click="OnRenameManuscriptMenuClicked"/>
                        <MenuItem Header="Rename Document" Click="OnRenameDocumentMenuClicked"/>
                        <Separator/>
                        <MenuItem Header="Undo" Click="OnUndoClicked"/>
                        <MenuItem Header="Redo" Click="OnRedoClicked"/>
                        <Separator/>
                        <MenuItem Header="Cut" Click="OnCutClicked" InputGesture="Ctrl+X"/>
                        <MenuItem Header="Copy" Click="OnCopyClicked" InputGesture="Ctrl+C"/>
                        <MenuItem Header="Paste" Click="OnPasteClicked" InputGesture="Ctrl+V"/>
                        <Separator/>
                        <MenuItem Header="Find and Replace..." Click="OnFindAndReplaceClicked" InputGesture="Ctrl+Shift+F"/>
                    </MenuItem>
                    <MenuItem Header="View" Foreground="#FFFFFF" SubmenuOpened="OnMenuSubmenuOpened">
                        <MenuItem x:Name="MenuTypewriterMode" Header="Typewriter Mode" Click="OnToggleTypewriterMode" InputGesture="Ctrl+Shift+T">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckTypewriterMode" IsChecked="False" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuFocusMode" Header="Focus Mode" Click="OnToggleFocusMode" InputGesture="Ctrl+1">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckFocusMode" IsChecked="False" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuSuperFocusMode" Header="Super Focus Mode" Click="OnToggleSuperFocusMode" InputGesture="Ctrl+0">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckSuperFocusMode" IsChecked="False" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuShowToolbar" Header="Show Toolbar" Click="OnToggleToolbar" InputGesture="Ctrl+2">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckToolbar" IsChecked="True" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuShowSidebar" Header="Show Project View" Click="OnToggleSidebar" InputGesture="Ctrl+3">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckSidebar" IsChecked="True" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuShowFooter" Header="Show Progress Bar" Click="OnToggleFooter" InputGesture="Ctrl+4">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckFooter" IsChecked="True" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuShowSpellCheck" Header="Show Spell Check" Click="OnToggleSpellCheck" InputGesture="Ctrl+5">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckSpellCheck" IsChecked="True" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator/>
                        <MenuItem x:Name="MenuThemedTitleBar" Header="Themed Title Bar" Click="OnToggleThemedTitleBar">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckThemedTitleBar" IsChecked="True" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem x:Name="MenuThemedCursor" Header="Themed Cursor" Click="OnToggleThemedCursor">
                            <MenuItem.Icon>
                                <CheckBox x:Name="CheckThemedCursor" IsChecked="True" IsHitTestVisible="False"/>
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Customize Theme..." Click="OnCustomizeAccentColorClicked"/>
                    </MenuItem>
                    <MenuItem Header="Help" Foreground="#FFFFFF" SubmenuOpened="OnMenuSubmenuOpened">
                        <MenuItem Header="Keyboard Shortcuts" Click="OnKeyboardShortcutsClicked"/>
                        <MenuItem Header="About" Click="OnAboutClicked"/>
                    </MenuItem>
                </Menu>

                <!-- Center: Title with Logo (draggable area) -->
                <Border x:Name="TitleBar" Grid.Column="1" Background="Transparent">
                    <StackPanel Orientation="Horizontal"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center">
                        <Image x:Name="LogoImage"
                               Source="avares://JetJot/Logo.png"
                               Height="24"
                               Margin="0,6,8,0"
                               VerticalAlignment="Center"
                               RenderTransformOrigin="0.5,0.5">
                            <Image.RenderTransform>
                                <TranslateTransform X="0" Y="0"/>
                            </Image.RenderTransform>
                        </Image>
                        <TextBlock x:Name="TitleBarText"
                                  Text="JetJot - Let Your Writing Fly"
                                  Foreground="#CCCCCC"
                                  FontSize="13"
                                  FontWeight="Normal"
                                  VerticalAlignment="Center"
                                  IsHitTestVisible="False"/>
                    </StackPanel>
                </Border>

                <!-- Right: Window Controls -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="0">
                    <Button x:Name="MinimizeButton"
                            Content="â”€"
                            Width="46"
                            Height="40"
                            Background="Transparent"
                            Foreground="#FFFFFF"
                            BorderThickness="0"
                            FontSize="10"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Click="OnMinimizeClick"/>
                    <Button x:Name="MaximizeButton"
                            Content="â–¡"
                            Width="46"
                            Height="40"
                            Background="Transparent"
                            Foreground="#FFFFFF"
                            BorderThickness="0"
                            FontSize="12"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Click="OnMaximizeClick"/>
                    <Button x:Name="CloseButton"
                            Content="âœ•"
                            Width="46"
                            Height="40"
                            Background="Transparent"
                            Foreground="#FFFFFF"
                            BorderThickness="0"
                            FontSize="12"
                            HorizontalContentAlignment="Center"
                            VerticalContentAlignment="Center"
                            Click="OnCloseClick">
                        <Button.Styles>
                            <Style Selector="Button:pointerover">
                                <Setter Property="Background" Value="#E81123"/>
                            </Style>
                        </Button.Styles>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <Grid x:Name="MainGrid" Grid.Row="1" Grid.RowSpan="2" Grid.Column="0" Grid.ColumnSpan="2" RowDefinitions="*,Auto,Auto">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="240" MinWidth="150" MaxWidth="320"/>
                <ColumnDefinition Width="0"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

        <!-- ========================= -->
        <!-- Sidebar -->
        <!-- ========================= -->
        <Border x:Name="SidebarPanel"
                Grid.Row="0"
                Grid.RowSpan="3"
                Grid.Column="0"
                Background="#2A2A2A"
                BorderBrush="#3A3A3A"
                BorderThickness="0,0,2,0">

            <Grid RowDefinitions="Auto,Auto,Auto,*,Auto">

                <!-- Manuscript Title (matches toolbar height) -->
                <Border Grid.Row="0"
                        Background="#2D2D2D"
                        Padding="12,8"
                        MinHeight="48"
                        DoubleTapped="OnManuscriptNameDoubleTapped"
                        Cursor="Hand"
                        x:DataType="local:Manuscript">
                    <Border.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Rename" Click="OnRenameManuscriptClicked"/>
                        </ContextMenu>
                    </Border.ContextMenu>
                    <Border.Styles>
                        <Style Selector="Border:pointerover">
                            <Setter Property="Background" Value="#3A3A3A"/>
                        </Style>
                    </Border.Styles>
                    <TextBlock x:Name="ManuscriptNameText"
                               Text="{Binding Name}"
                               FontSize="16"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"
                               HorizontalAlignment="Center"
                               Margin="0,2,0,0"
                               PointerEntered="OnManuscriptNamePointerEntered"
                               PointerExited="OnManuscriptNamePointerExited"/>
                </Border>

                <!-- Themed divider line -->
                <Border Grid.Row="1"
                        x:Name="ManuscriptDivider"
                        Height="2"
                        Background="{DynamicResource AccentBrush}"
                        HorizontalAlignment="Stretch"
                        Margin="0,0,-2,0"/>

                <!-- New Document Button -->
                <Button Grid.Row="2"
                        x:Name="NewDocumentButton"
                        Content="+ New Document"
                        Background="#3A3A3A"
                        Foreground="#FFFFFF"
                        BorderThickness="0"
                        Padding="12,8"
                        Margin="12,16,12,12"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Center"
                        CornerRadius="4"
                        Cursor="Hand"/>

                <!-- Middle Section (Scrollable Document and Section List) -->
                <ScrollViewer Grid.Row="3"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Disabled">
                    <StackPanel Margin="12,0,12,0" x:Name="SidebarContentPanel" Background="Transparent">
                        <StackPanel.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="New Document" Click="OnNewDocumentClicked"/>
                            </ContextMenu>
                        </StackPanel.ContextMenu>
                        <!-- Documents -->
                        <ListBox
                            x:Name="DocumentList"
                            Background="Transparent"
                            BorderThickness="0"
                            Foreground="#EAEAEA">
                            <ListBox.Styles>
                                <Style Selector="ListBoxItem">
                                    <Setter Property="Padding" Value="0"/>
                                </Style>
                                <Style Selector="ListBoxItem:selected /template/ ContentPresenter">
                                    <Setter Property="Background" Value="Transparent"/>
                                </Style>
                            </ListBox.Styles>
                            <ListBox.ItemTemplate>
                                <DataTemplate DataType="models:Document">
                                    <Border x:Name="ItemContainer"
                                            Padding="4"
                                            Margin="0,1"
                                            Background="Transparent"
                                            CornerRadius="4"
                                            BorderThickness="0,2,0,0"
                                            BorderBrush="Transparent"
                                            PointerPressed="OnDocumentPointerPressed"
                                            PointerMoved="OnDocumentPointerMoved"
                                            PointerReleased="OnDocumentPointerReleased"
                                            DoubleTapped="OnDocumentItemDoubleTapped">
                                        <Border.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Header="Rename" Click="OnRenameMenuClicked"/>
                                                <Separator/>
                                                <MenuItem Header="Lock" Click="OnLockMenuClicked" IsVisible="{Binding !IsLocked}"/>
                                                <MenuItem Header="Unlock" Click="OnUnlockMenuClicked" IsVisible="{Binding IsLocked}"/>
                                                <Separator/>
                                                <MenuItem Header="Move Up" Click="OnMoveUpClicked"/>
                                                <MenuItem Header="Move Down" Click="OnMoveDownClicked"/>
                                                <Separator/>
                                                <MenuItem Header="Delete" Click="OnDeleteMenuClicked"/>
                                            </ContextMenu>
                                        </Border.ContextMenu>
                                        <StackPanel Orientation="Horizontal" Spacing="6">
                                            <TextBlock Text="ðŸ”’"
                                                       IsVisible="{Binding IsLocked}"
                                                       VerticalAlignment="Center"
                                                       FontSize="12"/>
                                            <TextBlock Text="{Binding Title}"
                                                       VerticalAlignment="Center"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </StackPanel>
                </ScrollViewer>

                <!-- Bottom Section (Anchored Trash Icon) -->
                <Border Grid.Row="4"
                        x:Name="TrashZone"
                        Background="#2A2A2A"
                        BorderBrush="#3A3A3A"
                        BorderThickness="0,1,0,0"
                        Padding="12"
                        Margin="0,0,0,40"
                        PointerEntered="OnTrashZonePointerEnter"
                        PointerExited="OnTrashZonePointerLeave">
                    <StackPanel Orientation="Horizontal"
                               HorizontalAlignment="Center"
                               Spacing="8">
                        <TextBlock Text="ðŸ—‘ï¸"
                                  FontSize="20"
                                  VerticalAlignment="Center"/>
                        <TextBlock Text="Drop to Delete"
                                  Foreground="#888888"
                                  FontSize="12"
                                  VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>

            </Grid>
        </Border>

        <!-- ========================= -->
        <!-- GridSplitter for resizing sidebar -->
        <!-- ========================= -->
        <GridSplitter Grid.Row="0"
                      Grid.RowSpan="3"
                      Grid.Column="1"
                      Width="0"
                      Background="Transparent"
                      ResizeDirection="Columns"
                      HorizontalAlignment="Stretch"
                      VerticalAlignment="Stretch"
                      DragCompleted="OnSidebarResizeCompleted"/>

        <!-- ========================= -->
        <!-- Editor Area -->
        <!-- ========================= -->
        <Border x:Name="EditorAreaBorder"
                Grid.Row="0"
                Grid.Column="2"
                Padding="0">

            <Border x:Name="EditorInnerBorder"
                    CornerRadius="0"
                    Padding="0">

                <Grid RowDefinitions="Auto,*,Auto">

                    <!-- Formatting Toolbar -->
                    <Border x:Name="ToolbarPanel"
                            Grid.Row="0"
                            Background="#2D2D2D"
                            BorderBrush="#3A3A3A"
                            BorderThickness="0,0,0,2"
                            Padding="12,8">

                        <StackPanel Orientation="Horizontal"
                                   Spacing="16"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center">
                            <!-- Find bar -->
                            <StackPanel Orientation="Horizontal"
                                       Spacing="6"
                                       VerticalAlignment="Center">
                                <TextBox x:Name="FindTextBox"
                                        Width="200"
                                        Height="28"
                                        Watermark="Find..."
                                        Background="#3A3A3A"
                                        Foreground="#EAEAEA"
                                        BorderThickness="1"
                                        BorderBrush="#555555"
                                        Padding="6,4"
                                        VerticalContentAlignment="Center"/>
                                <Button x:Name="FindPreviousButton"
                                       Content="â—„"
                                       Width="28"
                                       Height="28"
                                       Background="#3A3A3A"
                                       Foreground="#EAEAEA"
                                       ToolTip.Tip="Previous (Shift+F3)"
                                       Focusable="False"
                                       HorizontalContentAlignment="Center"
                                       VerticalContentAlignment="Center"
                                       Padding="0"/>
                                <Button x:Name="FindNextButton"
                                       Content="â–º"
                                       Width="28"
                                       Height="28"
                                       Background="#3A3A3A"
                                       Foreground="#EAEAEA"
                                       ToolTip.Tip="Next (F3)"
                                       Focusable="False"
                                       HorizontalContentAlignment="Center"
                                       VerticalContentAlignment="Center"
                                       Padding="0"/>
                                <Button x:Name="ClearFindButton"
                                       Content="âœ•"
                                       Width="28"
                                       Height="28"
                                       Background="#3A3A3A"
                                       Foreground="#EAEAEA"
                                       ToolTip.Tip="Clear"
                                       Focusable="False"
                                       HorizontalContentAlignment="Center"
                                       VerticalContentAlignment="Center"
                                       Padding="0"/>
                            </StackPanel>

                            <!-- Font controls -->
                            <StackPanel Orientation="Horizontal"
                                       Spacing="8"
                                       VerticalAlignment="Center">
                                <ComboBox x:Name="FontFamilyComboBox"
                                         Width="140"
                                         SelectedIndex="0">
                                    <ComboBoxItem Content="IBM Plex Sans"/>
                                    <ComboBoxItem Content="Calibri"/>
                                    <ComboBoxItem Content="Arial"/>
                                    <ComboBoxItem Content="Times New Roman"/>
                                    <ComboBoxItem Content="Georgia"/>
                                    <ComboBoxItem Content="Courier New"/>
                                    <ComboBoxItem Content="Consolas"/>
                                    <ComboBoxItem Content="Verdana"/>
                                </ComboBox>

                                <ComboBox x:Name="FontSizeComboBox"
                                         Width="70"
                                         SelectedIndex="2">
                                    <ComboBoxItem Content="12"/>
                                    <ComboBoxItem Content="14"/>
                                    <ComboBoxItem Content="16"/>
                                    <ComboBoxItem Content="18"/>
                                    <ComboBoxItem Content="20"/>
                                    <ComboBoxItem Content="24"/>
                                    <ComboBoxItem Content="28"/>
                                    <ComboBoxItem Content="32"/>
                                </ComboBox>
                            </StackPanel>

                            <!-- Accent Color Picker -->
                            <StackPanel Orientation="Horizontal"
                                       Spacing="8"
                                       VerticalAlignment="Center">
                                <Button x:Name="AccentColorButton"
                                       Width="32"
                                       Height="28"
                                       Background="#4A5D73"
                                       BorderThickness="1"
                                       BorderBrush="#555555"
                                       CornerRadius="4"
                                       Padding="0"
                                       Click="OnAccentColorButtonClicked">
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- Text Editor -->
                    <Grid Grid.Row="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Margin Indicators - outside the padding so they span full width -->
                        <Canvas Grid.Row="0" Height="12" Background="Transparent" x:Name="MarginIndicatorCanvas">
                            <!-- Left margin indicator -->
                            <Border x:Name="LeftMarginIndicator"
                                    Width="2"
                                    Height="12"
                                    Background="{DynamicResource AccentBrush}"
                                    Opacity="0.6"
                                    Cursor="SizeWestEast"
                                    Canvas.Left="40"
                                    Canvas.Top="0"/>

                            <!-- Right margin indicator -->
                            <Border x:Name="RightMarginIndicator"
                                    Width="2"
                                    Height="12"
                                    Background="{DynamicResource AccentBrush}"
                                    Opacity="0.6"
                                    Cursor="SizeWestEast"
                                    Canvas.Top="0"/>
                        </Canvas>

                        <Border Grid.Row="1" x:Name="EditorBorder" Padding="40,20">
                            <ScrollViewer x:Name="EditorScrollViewer"
                                         HorizontalScrollBarVisibility="Disabled"
                                         VerticalScrollBarVisibility="Auto">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Top spacer for typewriter mode "scroll past start" -->
                                    <Border Grid.Row="0"
                                            x:Name="TypewriterTopSpacer"
                                            Background="Transparent"
                                            Height="0"/>

                                    <Grid Grid.Row="1">
                                    <TextBox
                                        x:Name="Editor"
                                        AcceptsReturn="True"
                                        AcceptsTab="True"
                                        FontSize="16"
                                        BorderThickness="0"
                                        TextWrapping="Wrap"
                                        VerticalAlignment="Stretch"
                                        MinHeight="500"
                                        CaretBrush="{DynamicResource CaretBrush}"
                                        SelectionBrush="{DynamicResource AccentBrush}"
                                        SelectionForegroundBrush="#FFFFFF">
                                        <TextBox.Styles>
                                            <Style Selector="TextBox:focus /template/ Border#PART_BorderElement">
                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                <Setter Property="BorderThickness" Value="0"/>
                                                <Setter Property="Background" Value="#1A1A1A"/>
                                            </Style>
                                            <Style Selector="TextBox:pointerover /template/ Border#PART_BorderElement">
                                                <Setter Property="Background" Value="#1A1A1A"/>
                                            </Style>
                                            <Style Selector="TextBox /template/ Border#PART_BorderElement">
                                                <Setter Property="Background" Value="#1A1A1A"/>
                                            </Style>
                                        </TextBox.Styles>
                                    </TextBox>
                                    <Canvas x:Name="SpellcheckOverlay"
                                            IsHitTestVisible="False"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Stretch"
                                            Panel.ZIndex="1"/>
                                </Grid>

                                    <!-- Bottom spacer for typewriter mode "scroll past end" -->
                                        <Border Grid.Row="2"
                                                x:Name="TypewriterBottomSpacer"
                                                Background="Transparent"
                                                Height="0"/>
                                    </Grid>
                                </ScrollViewer>
                            </Border>
                        </Grid>

                    <!-- Spell Check Indicator -->
                    <Button x:Name="SpellCheckIndicatorBar"
                            Grid.Row="2"
                            Background="Transparent"
                            Padding="40,4,40,4"
                            IsVisible="False"
                            HorizontalAlignment="Right"
                            BorderThickness="0"
                            Cursor="Hand"
                            HorizontalContentAlignment="Right">
                        <TextBlock x:Name="SpellCheckIndicator"
                                  Text=""
                                  Foreground="#FF9800"
                                  VerticalAlignment="Center"
                                  FontSize="11"
                                  ToolTip.Tip="Click to jump to next misspelled word"/>
                    </Button>

                </Grid>

            </Border>
        </Border>

        <!-- ========================= -->
        <!-- Footer -->
        <!-- ========================= -->
        <Border x:Name="FooterPanel"
                Grid.Row="2"
                Grid.Column="0"
                Grid.ColumnSpan="3"
                Background="#2D2D2D"
                BorderBrush="#3A3A3A"
                BorderThickness="0,1,0,0"
                MinHeight="32"
                Padding="20,0">

            <Grid ColumnDefinitions="Auto,*,Auto,Auto">
                <!-- Word count text -->
                <TextBlock Grid.Column="0"
                          x:Name="WordCountText"
                          Text="0 / 1000 words"
                          Foreground="#CCCCCC"
                          VerticalAlignment="Center"
                          FontSize="12"/>

                <!-- Progress bar -->
                <ProgressBar Grid.Column="1"
                            x:Name="WordProgressBar"
                            Minimum="0"
                            Maximum="1000"
                            Value="0"
                            Height="8"
                            Margin="16,0"
                            VerticalAlignment="Center"
                            Foreground="#4CAF50"
                            Background="#3A3A3A"/>

                <!-- Save feedback -->
                <TextBlock Grid.Column="2"
                          x:Name="SaveFeedbackText"
                          Text="âœ“ Saved"
                          Foreground="{DynamicResource AccentBrush}"
                          VerticalAlignment="Center"
                          FontSize="12"
                          Margin="0,0,16,0"
                          IsVisible="False"/>

                <!-- Goal setter button -->
                <Button Grid.Column="3"
                       x:Name="SetGoalButton"
                       Content="Set Goal"
                       Padding="12,6"
                       FontSize="12"
                       Background="#3A3A3A"
                       Foreground="#FFFFFF"
                       BorderThickness="0"
                       CornerRadius="4"
                       Cursor="Hand"/>
            </Grid>
        </Border>

        </Grid>

        <!-- Super Focus Mode Exit Hint Overlay -->
        <Border x:Name="SuperFocusHintOverlay"
                Grid.Row="0"
                Grid.RowSpan="3"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                Background="Transparent"
                IsVisible="False"
                IsHitTestVisible="False">
            <Border Background="#AA000000"
                    Padding="24,12"
                    CornerRadius="8"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Margin="0,40,0,0">
                <TextBlock Text="Press Escape to Exit"
                          Foreground="#FFFFFF"
                          FontSize="16"
                          FontWeight="SemiBold"/>
            </Border>
        </Border>
    </Grid>
</Window>

